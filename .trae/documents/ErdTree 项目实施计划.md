# ErdTree 实施计划

## 项目概述
ErdTree 是一个非线性思维导图与对话版本管理系统，旨在解决大语言模型交互中人类思考的非线性与 LLM 上下文窗口线性之间的维度错位问题。

## 技术架构

### 前端
- **框架**: Next.js
- **可视化**: React Flow (节点编辑器)
- **状态管理**: Zustand / TanStack Query
- **UI 组件**: Tailwind CSS

### 后端
- **语言**: Python (FastAPI)
- **数据库**: Supabase (Postgres + pgvector)
- **LLM 集成**: Vercel AI SDK
- **向量处理**: LangChain/LlamaIndex

### 模型选择
- **核心模型**: Claude 3.5 Sonnet (逻辑理解和编码能力强)
- **摘要模型**: GPT-4o-mini (成本效益高)

## 数据结构

### 数据库表结构
- `projects`: 存储项目信息和系统提示
- `nodes`: 存储对话节点，包含内容、摘要、嵌入向量等元数据

## 核心功能模块

### 1. 上下文组装器 (Context Assembler)
- 回溯路径计算
- 动态剪枝策略
- 检查点摘要压缩
- RAG 相关节点注入

### 2. 交互层 (Graph UI)
- 流模式 (Stream View): 类似普通聊天界面
- 上帝模式 (God View): 树状结构可视化
- 幽灵节点: 预判可能的分支方向

### 3. 记忆层 (Vector Vault)
- 组合嵌入策略 (content + summary)
- 跨项目检索能力
- 向量相似度计算

## 分阶段开发路线

### Phase 1: 基础对话与撤销功能 (2周)
- 单线对话实现
- 历史消息编辑与分支生成
- 基础数据库结构搭建

### Phase 2: 树状可视化 (3周)
- 集成 React Flow
- 侧边栏树状结构显示
- 节点点击跳转功能

### Phase 3: 智能摘要与压缩 (4周)
- 后台异步摘要生成
- 上下文组装器优化
- Token 消耗控制

### Phase 4: 语义合并与高级功能 (3周)
- 分支语义合并
- 跨项目检索
- 完整 RAG 集成

## 技术挑战与解决方案

### 1. 上下文重组的 Token 消耗
- **解决方案**: 检查点机制 + 摘要压缩

### 2. 用户认知门槛
- **解决方案**: 避免 Git 术语，使用直观的 UI 隐喻

### 3. 语义合并复杂性
- **解决方案**: LLM 辅助的语义融合

## 预期成果
一个功能完整的非线性对话管理系统，让用户能够：
- 自由创建和管理对话分支
- 可视化查看思考路径
- 享受无限记忆和上下文纯净度
- 无缝集成最新的 LLM 模型

## 开发优先级
1. 核心上下文组装逻辑
2. 直观的用户界面
3. 高效的向量存储与检索
4. 智能摘要与合并功能